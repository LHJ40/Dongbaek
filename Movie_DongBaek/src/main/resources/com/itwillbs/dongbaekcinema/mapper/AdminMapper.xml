<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.dongbaekcinema.mapper.AdminMapper">

	<!-- 영화관 목록 조회 -->
	<select id="getTeater" resultType="hashmap">
		SELECT 
			theater_num
			, theater_name
			FROM 
				THEATERS
	</select>
	
    
    	<!-- 영화관 별 스케줄 목록 조회 -->
    <select id="selectScheduleList" resultType="com.itwillbs.dongbaekcinema.vo.PlayVO">
        SELECT
				*
          FROM
              PLAYS p
          JOIN 
          	THEATERS t
         	 ON p.theater_num = t.theater_num
          JOIN 
          	MOVIES m
       	   	ON p.movie_num = m.movie_num
          JOIN 
          	ROOMS r
        	ON p.room_num = r.room_num
			WHERE
		    	play_date = #{play_date}
		    AND 
		    	r.room_num = #{pageNo}
		ORDER BY
		    play_num
    </select>
    


	<!-- 상영날짜 별 선택가능한 영화 목록 조회 -->
	<select id="findMovieList" resultType="com.itwillbs.dongbaekcinema.vo.MovieVO">
		SELECT 
			movie_num, movie_name_kr
			FROM 
				MOVIES
			WHERE
				#{play_date} 
			BETWEEN movie_release_date
			AND movie_close_date
	</select>

   
    <!-- 영화목록 셀렉트 박스 클릭 시 DB에서 회차 생성 관련 정보 가져오기 -->
	<select id="getTurnInfo" resultType="com.itwillbs.dongbaekcinema.voNew.PlayScheduleVO">
		SELECT 
			p.movie_num
			, movie_name_kr
			, movie_release_date
			, movie_close_date
			, movie_running_time
			, room_start_time
			, room_end_time
			, play_turn
			, play_start_time
			, play_end_time
			, play_time_type
			FROM 
				MOVIES m
			JOIN  
				PLAYS p
			ON	
				p.movie_num = m.movie_num 
			JOIN 
				THEATERS t
			ON 
				p.theater_num = t.theater_num
			JOIN 
				ROOMS r
			ON 
				p.room_num = r.room_num
			WHERE 
				p.theater_num = #{theater_num}
			AND 
				p.room_num = #{pageNo}
			AND 
				p.movie_num = #{movie_num}
	</select>
	
	<!-- CS 게시판 condition 변수에 따라 목록List<CsVO> 출력 -->
    <select id="getCsWithPaging" resultType="com.itwillbs.dongbaekcinema.vo.CsVO">
    	SELECT
    		 * 
    		 FROM 
    		 	CS 
    		 WHERE 
    		 	cs_type IN(${condition}) 
    		 	ORDER BY cs_type_list_num  DESC 
    		 	LIMIT #{start}, #{pageSize}
    </select>
    
    <!-- CS 게시판 condition 변수에 따라 총 게시물 수 출력 -->
    <select id="getCsCount" resultType="int">
    	SELECT 
    		COUNT(*)
    		FROM
   				CS
   			WHERE
   				cs_type IN(${condition})
    </select>


	<!-- CS 게시판 condition 변수에 따라 글수정, 답글 달기 시 해당 타입글번호 CsVO 출력 -->
    <select id="getCsInfo" resultType="com.itwillbs.dongbaekcinema.voNew.CsInfoVO">
    	SELECT
    		 * 
    		 FROM 
    		 	CS c
    		 	JOIN
    		 		MEMBERS m
    		 		ON c.member_id = m.member_id
    		 WHERE 
    		 	cs_type IN(${condition})
    		 	AND cs_type_list_num = ${cs_type_list_num}
    </select>
    
    <!-- CS-1:1 게시판 관리자 답변 달기 -->
    <update id="updateReply">
		UPDATE 
			CS
			SET cs_reply = #{qnaInfo.cs_reply}
    		 WHERE 
    		 	cs_type IN(${condition})
    		 	AND cs_type_list_num = #{qnaInfo.cs_type_list_num}				
	</update>
</mapper>