<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itwillbs.dongbaekcinema.mapper.MovieLikeMapper">
	
	<!-- 찜한 영화 찾기(지영) - SELECT -->
	<select id="selectLikeMovie" resultType="com.itwillbs.dongbaekcinema.vo.MovieLikeVO">
		SELECT *
			FROM LIKES
			WHERE member_id = #{member_id}
	</select>
	
	<!-- 찜 기능 - INSERT -->
	<insert id="insertLikeMovie">
		INSERT
			INTO LIKES
				(
				member_id
				, movie_num
				)
		VALUES
				(
				#{member_id}
				, #{movie_num}
				)
	</insert>
	
	<!-- 찜 취소 기능 - DELETE -->
	<delete id="deleteLikeMovie">
		DELETE
			FROM LIKES
		WHERE
			member_id = #{member_id}
			AND movie_num = ${movie_num}
	</delete>
	
	<!-- 찜 영화 갯수 세기 - SELECT -->
	<select id="countLikeMovie">
		SELECT COUNT(*)
			FROM LIKES
			WHERE member_id = #{member_id}
	</select>
	
	<!-- 찜한 영화 목록 조회 - SELECT -->
	<select id="selectLikeMovieList" resultType="com.itwillbs.dongbaekcinema.vo.MovieLikeVO">
<!-- 		SELECT * -->
<!-- 			FROM LIKES -->
<!-- 			JOIN MOVIES ON  -->
		SELECT mm.member_id, mv.*
			FROM LIKES l 
			JOIN MEMBERS mm 
				ON mm.member_id = l.member_id
			JOIN MOVIES mv 
				ON mv.movie_num = l.movie_num 
			WHERE mm.member_id = #{member_id}
				AND mv.movie_close_date >= now()
			ORDER BY mv.movie_close_date ASC
			LIMIT #{startRow}, #{listLimit}
	</select>
	
</mapper>
